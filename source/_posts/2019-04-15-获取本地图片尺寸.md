---
title: '获取本地图片尺寸'
date: 2019-04-15
categories: 前端 # 分类只能有1个
tags: # 标签可以有多个
  - 图片尺寸
  - 文件上传
---

主动获取本地图片的尺寸

<!-- more -->

## 获取本地图片的尺寸

```js
export function beforeImageInfo(file) {
  return new Promise((resolve, reject) => {
    if (!/^image\/[jpeg|png|jpg|gif|svg|ico]/gi.test(file.type)) {
      message.warning('请上传图片类型文件')
      return
    }
    const img = new Image() // new 一个图片实例
    img.src = URL.createObjectURL(file) // 创建 URL 的 File 对象或者 Blob 对象
    img.onload = function() {
      const { width, height } = this
      resolve({
        height,
        width
      })
    }
    img.onerror = e => {
      message.error('图片加载失败')
      reject(e)
    }
  })
}
```

### 在组件中使用

```js
async validateImageSize(file) {
    const { width, height } = await beforeImageInfo(file)
    console.log(width, height)
    if (width !== 260 || height !== 185) {
      const message = '尺寸限制：1920x1276'
      this.$message.warning(message)
      return Promise.reject('验证失败') // 即使使用return退出后，还是需要抛出一个错误，防止Promise被挂起
    }
    return true
  }
```
